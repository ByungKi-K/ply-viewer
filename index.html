<script>
    function loadPLYModel(containerId, fileName) {
        const container = document.getElementById(containerId);
        const width = container.clientWidth;
        const height = container.clientHeight;

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 100);
        camera.position.set(0, 0, 2);

        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(width, height);
        container.appendChild(renderer.domElement);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        const light = new THREE.AmbientLight(0xffffff, 1);
        scene.add(light);

        const loader = new THREE.PLYLoader();
        
        // ✅ GitHub LFS 파일 로드 URL 수정 (직접 URL 사용 불가)
        const rawGitHubLFSUrl = `https://github.com/ByungKi-K/ply-viewer/raw/main/${fileName}`;
        
        // 🚀 CORS 프록시를 사용하여 GitHub LFS 파일 로드
        const proxyUrl = "https://cors-anywhere.herokuapp.com/";
        const filePath = proxyUrl + rawGitHubLFSUrl;

        loader.load(filePath, function (geometry) {
            console.log(`${fileName} Loaded Successfully`, geometry);
            geometry.computeVertexNormals();
            const material = new THREE.PointsMaterial({ size: 0.01, vertexColors: true });
            const pointCloud = new THREE.Points(geometry, material);
            scene.add(pointCloud);
        }, 
        function (xhr) {
            console.log(`${fileName} Loading: ${(xhr.loaded / xhr.total * 100).toFixed(2)}%`);
        }, 
        function (error) {
            console.error(`Error loading ${fileName}:`, error);
        });

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();
    }

    loadPLYModel("marigold", "marigold.ply");
    loadPLYModel("geowizard", "geowizard.ply");
    loadPLYModel("ours", "ours.ply");
</script>

