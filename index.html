<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>3D PLY Viewer</title>
  <style>
    body { margin: 0; }
    canvas { display: block; }
  </style>
</head>
<body>
  <div id="container"></div>
  <!-- Three.js CDN (stable 버전) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
  <!-- PLYLoader (three.js examples에서 따로 로드 필요) -->
  <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r152/examples/jsm/loaders/PLYLoader.js"></script>
  <!-- Main Script -->
  <script>
    let scene, camera, renderer, controls;
    init();
    animate();

    function init() {
      // 장면(Scene) 생성
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0xdddddd);

      // 카메라(Camera) 설정
      camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
      camera.position.set(0, 0, 2);

      // 렌더러(Renderer) 생성
      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      // 조명(Light)
      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(1, 1, 1).normalize();
      scene.add(light);

      // PLY 파일 로드
      const loader = new THREE.PLYLoader();
      loader.load(
        'ours.ply', // 여기서 .ply 파일 경로 지정
        function (geometry) {
          geometry.computeVertexNormals();  // 법선(Normal) 계산
          
          // 포인트 클라우드(PointCloud)로 렌더링할 경우
          // const material = new THREE.PointsMaterial({ size: 0.01, vertexColors: true });
          // const mesh = new THREE.Points(geometry, material);

          // 메시(Mesh)로 렌더링할 경우(색상 정보가 있으면 vertexColors 사용 가능)
          const material = new THREE.MeshLambertMaterial({ vertexColors: true });
          const mesh = new THREE.Mesh(geometry, material);

          scene.add(mesh);
        },
        // onProgress
        (xhr) => {
          console.log((xhr.loaded / xhr.total * 100) + '% loaded');
        },
        // onError
        (error) => {
          console.error('An error happened while loading the PLY file:', error);
        }
      );

      // 윈도우 리사이즈 대응
      window.addEventListener('resize', onWindowResize);

      // (선택) OrbitControls 사용 시
      // <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r152/examples/jsm/controls/OrbitControls.js"></script>
      // orbit 컨트롤 추가해주면 마우스로 회전, 줌 가능
      // controls = new THREE.OrbitControls(camera, renderer.domElement);
    }

    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function animate() {
      requestAnimationFrame(animate);
      // controls && controls.update(); // OrbitControls 사용할 경우
      renderer.render(scene, camera);
    }
  </script>
</body>
</html>

